================================================================================
                    NOSTR BADGES GUI - PROJECT PLAN
                    Full-Stack Web Application
================================================================================

CREATED: 2025-12-26
STATUS: Planning Phase - Pending Review

================================================================================
                           PROJECT OVERVIEW
================================================================================

GOAL:
Create a web-based GUI for the existing Nostr Badges CLI application.
The system has two main user types:
  1. Badge Creators (Issuers) - Create and award badges to users
  2. Badge Receivers - View, accept, and manage received badges

TECH STACK:
  • Backend: Python (FastAPI) - wraps existing CLI modules
  • Frontend: Vue.js 3 + JavaScript
  • Protocol: Nostr (NIP-58 Badges)
  • Deployment: Single VPS, no database required

================================================================================
                        EXISTING CODEBASE SUMMARY
================================================================================

DIRECTORY STRUCTURE:
├── badge_tool/           # Badge Creator tools
│   ├── badge_creator.py     → BadgeCreator class (kind 30009, kind 8)
│   ├── badge_tool.py        → Main CLI for awarding badges
│   ├── accept_badge.py      → CLI for accepting badges
│   ├── profile_badges_helper.py → Profile badges (kind 30008)
│   ├── badges/definitions/  → Badge template JSON files
│   └── config.json          → Relay URLs config
│
├── badge_inbox/          # Badge Receiver tools
│   ├── badge_inbox.py       → Full inbox CLI (login, view, accept, remove)
│   └── config.json          → Relay URLs config
│
├── common/               # Shared utilities
│   ├── relay_manager.py     → Relay connections, publish, verify
│   ├── recipient_acceptance.py → BadgeAcceptanceManager class
│   └── nostr_utils.py       → Event signing utilities

EXISTING FUNCTIONALITY (Working in CLI):
  ✓ Create badge definitions (kind 30009)
  ✓ Award badges to recipients (kind 8)
  ✓ Accept badges and update profile (kind 30008)
  ✓ View pending/accepted badges
  ✓ Remove accepted badges
  ✓ Fetch badge metadata from relays
  ✓ Fetch issuer/user profile info
  ✓ Backup system for badge data
  ✓ Multi-relay publishing with verification

================================================================================
                         ARCHITECTURE DESIGN
================================================================================

┌─────────────────────────────────────────────────────────────────────────────┐
│                               VPS (Single Server)                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────────────────────┐       ┌─────────────────────────────┐    │
│   │     Vue.js Frontend         │       │     FastAPI Backend         │    │
│   │     (Nginx - Port 80/443)   │ ←───→ │     (Uvicorn - Port 8000)   │    │
│   │                             │       │                             │    │
│   │  Pages:                     │       │  REST API:                  │    │
│   │  • /login                   │       │  • /api/auth/*              │    │
│   │  • /creator (badge issuer)  │       │  • /api/badges/*            │    │
│   │  • /inbox (badge receiver)  │       │  • /api/profile/*           │    │
│   │  • /profile                 │       │                             │    │
│   │                             │       │  Uses:                      │    │
│   │  Components:                │       │  • badge_creator.py         │    │
│   │  • BadgeCard                │       │  • recipient_acceptance.py  │    │
│   │  • BadgeList                │       │  • relay_manager.py         │    │
│   │  • AwardForm                │       │                             │    │
│   │  • LoginModal               │       │                             │    │
│   └─────────────────────────────┘       └─────────────────────────────┘    │
│                                                    │                        │
│                                                    ▼                        │
│                                         ┌─────────────────────┐            │
│                                         │  Nostr Relays       │            │
│                                         │  (External)         │            │
│                                         │  wss://relay.damus  │            │
│                                         │  wss://nos.lol      │            │
│                                         │  ...                │            │
│                                         └─────────────────────┘            │
└─────────────────────────────────────────────────────────────────────────────┘

NOTES:
  • No database required - all data is on Nostr relays
  • Private keys (nsec) stored in browser session only (never persisted)
  • API is stateless - nsec passed in headers for authenticated requests

================================================================================
                           API ENDPOINTS DESIGN
================================================================================

BASE URL: /api/v1

────────────────────────────────────────────────────────────────────────────────
AUTHENTICATION (Keys)
────────────────────────────────────────────────────────────────────────────────
POST /auth/validate
  Body: { "nsec": "nsec1..." }
  Response: { "valid": true, "npub": "npub1...", "hex": "..." }
  Notes: Validates key and returns public key info

────────────────────────────────────────────────────────────────────────────────
PROFILE
────────────────────────────────────────────────────────────────────────────────
GET /profile/{npub_or_hex}
  Response: { "name": "...", "display_name": "...", "picture": "..." }
  Notes: Fetches kind 0 metadata from relays

GET /profile/badges/{npub_or_hex}
  Response: { "accepted": [...], "pending": [...] }
  Notes: Returns accepted and pending badges for user

────────────────────────────────────────────────────────────────────────────────
BADGE DEFINITIONS (Creator)
────────────────────────────────────────────────────────────────────────────────
GET /badges/templates
  Response: [{ "identifier": "...", "name": "...", "description": "...", "image": "..." }]
  Notes: Returns available badge templates from JSON files

POST /badges/templates
  Headers: X-Nsec: nsec1...
  Body: { "identifier": "...", "name": "...", "description": "...", "image": "..." }
  Response: { "success": true, "template": {...} }
  Notes: Creates new badge template (saves to JSON)

GET /badges/definition/{a_tag}
  Response: { "name": "...", "description": "...", "image": "...", "issuer": {...} }
  Notes: Fetches badge definition from relays

────────────────────────────────────────────────────────────────────────────────
BADGE AWARDING (Creator)
────────────────────────────────────────────────────────────────────────────────
POST /badges/create-definition
  Headers: X-Nsec: nsec1...
  Body: { "identifier": "...", "name": "...", "description": "...", "image": "..." }
  Response: { "success": true, "a_tag": "30009:pubkey:identifier", "event_id": "..." }
  Notes: Creates and publishes badge definition (kind 30009)

POST /badges/award
  Headers: X-Nsec: nsec1...
  Body: { "a_tag": "30009:...", "recipients": ["npub1...", "npub2..."] }
  Response: { "success": true, "award_event_id": "...", "recipients_count": 2 }
  Notes: Awards badge to recipients (kind 8)

POST /badges/create-and-award
  Headers: X-Nsec: nsec1...
  Body: { 
    "badge": { "identifier": "...", "name": "...", ... },
    "recipients": ["npub1...", "npub2..."]
  }
  Response: { "success": true, "a_tag": "...", "award_event_id": "..." }
  Notes: Combines definition + award in one call

────────────────────────────────────────────────────────────────────────────────
BADGE INBOX (Receiver)
────────────────────────────────────────────────────────────────────────────────
GET /inbox/pending
  Headers: X-Nsec: nsec1...
  Response: [{ 
    "award_event_id": "...", 
    "a_tag": "...", 
    "badge_name": "...",
    "issuer_name": "...",
    "issuer_npub": "..."
  }]
  Notes: Returns pending (not yet accepted) badges

GET /inbox/accepted
  Headers: X-Nsec: nsec1...
  Response: [{ 
    "a_tag": "...", 
    "award_event_id": "...",
    "badge_name": "...",
    "issuer_name": "..."
  }]
  Notes: Returns accepted badges

POST /inbox/accept
  Headers: X-Nsec: nsec1...
  Body: { "a_tag": "...", "award_event_id": "..." }
  Response: { "success": true, "profile_event_id": "...", "total_badges": 5 }
  Notes: Accepts badge and updates profile (kind 30008)

POST /inbox/remove
  Headers: X-Nsec: nsec1...
  Body: { "a_tag": "...", "award_event_id": "..." }
  Response: { "success": true, "remaining_badges": 4 }
  Notes: Removes badge from profile

────────────────────────────────────────────────────────────────────────────────
RELAY STATUS
────────────────────────────────────────────────────────────────────────────────
GET /relays
  Response: [{ "url": "wss://...", "status": "connected" }]
  Notes: Returns configured relays and their status

================================================================================
                         FRONTEND STRUCTURE
================================================================================

PROJECT STRUCTURE:
frontend/
├── public/
│   └── index.html
├── src/
│   ├── main.js
│   ├── App.vue
│   ├── router/
│   │   └── index.js
│   ├── stores/                    # Pinia stores
│   │   ├── auth.js                # nsec/npub state
│   │   ├── badges.js              # badges data
│   │   └── ui.js                  # loading states, modals
│   ├── api/
│   │   └── client.js              # Axios API client
│   ├── views/
│   │   ├── LoginView.vue          # nsec login page
│   │   ├── CreatorView.vue        # Badge creation/awarding
│   │   ├── InboxView.vue          # Badge inbox (pending/accepted)
│   │   └── ProfileView.vue        # User profile + badges display
│   ├── components/
│   │   ├── common/
│   │   │   ├── AppHeader.vue
│   │   │   ├── AppFooter.vue
│   │   │   ├── LoadingSpinner.vue
│   │   │   └── ToastNotification.vue
│   │   ├── auth/
│   │   │   └── NsecInput.vue
│   │   ├── badges/
│   │   │   ├── BadgeCard.vue      # Single badge display
│   │   │   ├── BadgeList.vue      # List of badges
│   │   │   ├── BadgePreview.vue   # Badge preview (image + name)
│   │   │   └── BadgeModal.vue     # Badge details modal
│   │   ├── creator/
│   │   │   ├── TemplateSelector.vue
│   │   │   ├── RecipientInput.vue
│   │   │   └── AwardConfirm.vue
│   │   └── inbox/
│   │       ├── PendingBadges.vue
│   │       └── AcceptedBadges.vue
│   └── assets/
│       └── styles/
│           └── main.css
├── package.json
└── vite.config.js

================================================================================
                              TODO LIST
================================================================================

PHASE 1: BACKEND API (Python FastAPI)
────────────────────────────────────────────────────────────────────────────────
[ ] 1.1  Create backend folder structure
[ ] 1.2  Set up FastAPI application with CORS
[ ] 1.3  Create API service layer wrapping existing modules
[ ] 1.4  Implement auth endpoints (/auth/validate)
[ ] 1.5  Implement profile endpoints (/profile/*)
[ ] 1.6  Implement badge template endpoints (/badges/templates)
[ ] 1.7  Implement badge creation endpoints (/badges/create-*)
[ ] 1.8  Implement badge award endpoints (/badges/award)
[ ] 1.9  Implement inbox endpoints (/inbox/*)
[ ] 1.10 Implement relay status endpoint
[ ] 1.11 Add error handling and validation
[ ] 1.12 Test all endpoints with curl/Postman

PHASE 2: FRONTEND SETUP (Vue.js)
────────────────────────────────────────────────────────────────────────────────
[ ] 2.1  Initialize Vue 3 project with Vite
[ ] 2.2  Install dependencies (Vue Router, Pinia, Axios)
[ ] 2.3  Set up project structure
[ ] 2.4  Create API client (axios instance)
[ ] 2.5  Set up Pinia stores (auth, badges, ui)
[ ] 2.6  Configure Vue Router
[ ] 2.7  Create base layout components

PHASE 3: FRONTEND PAGES
────────────────────────────────────────────────────────────────────────────────
[ ] 3.1  Create Login page (nsec input)
[ ] 3.2  Create Creator page (badge templates + award form)
[ ] 3.3  Create Inbox page (pending + accepted tabs)
[ ] 3.4  Create Profile page (display badges)
[ ] 3.5  Implement navigation and routing guards

PHASE 4: FRONTEND COMPONENTS
────────────────────────────────────────────────────────────────────────────────
[ ] 4.1  BadgeCard component
[ ] 4.2  BadgeList component
[ ] 4.3  RecipientInput component (npub input with validation)
[ ] 4.4  TemplateSelector component
[ ] 4.5  Loading states and error handling
[ ] 4.6  Toast notifications

PHASE 5: STYLING & UX
────────────────────────────────────────────────────────────────────────────────
[ ] 5.1  Design system (colors, typography, spacing)
[ ] 5.2  Responsive layout (mobile-friendly)
[ ] 5.3  Badge card styling (image, shimmer effects)
[ ] 5.4  Form styling
[ ] 5.5  Loading animations
[ ] 5.6  Dark/light theme (optional)

PHASE 6: INTEGRATION & TESTING
────────────────────────────────────────────────────────────────────────────────
[ ] 6.1  Connect frontend to backend API
[ ] 6.2  Test full badge creation flow
[ ] 6.3  Test full badge acceptance flow
[ ] 6.4  Test error scenarios
[ ] 6.5  Cross-browser testing

PHASE 7: DEPLOYMENT
────────────────────────────────────────────────────────────────────────────────
[ ] 7.1  Set up VPS environment
[ ] 7.2  Configure Nginx for Vue frontend
[ ] 7.3  Configure systemd for FastAPI backend
[ ] 7.4  Set up SSL certificates (Let's Encrypt)
[ ] 7.5  Configure firewall rules
[ ] 7.6  Deploy and test in production

================================================================================
                           USER FLOWS
================================================================================

FLOW 1: Badge Creator Awards a Badge
────────────────────────────────────────────────────────────────────────────────
1. User navigates to /creator
2. User enters their nsec (issuer private key)
3. User selects a badge template or creates new one
4. User enters recipient pubkeys (npub or hex)
5. User confirms and submits
6. Backend creates badge definition (kind 30009)
7. Backend creates badge award (kind 8)
8. Both events published to relays
9. User sees success message with event IDs
10. Recipients can now see pending badge in their inbox

FLOW 2: Badge Receiver Accepts a Badge
────────────────────────────────────────────────────────────────────────────────
1. User navigates to /inbox
2. User enters their nsec (recipient private key)
3. System fetches pending badges from relays
4. User sees list of pending badges with issuer info
5. User clicks "Accept" on a badge
6. Backend merges with existing profile badges
7. Backend publishes updated profile badges (kind 30008)
8. Badge moves from "Pending" to "Accepted" tab
9. Badge now visible on user's Nostr profile

FLOW 3: View Public Profile Badges
────────────────────────────────────────────────────────────────────────────────
1. User navigates to /profile/{npub}
2. System fetches profile metadata (kind 0)
3. System fetches profile badges (kind 30008)
4. System fetches badge definitions for each badge
5. User sees profile info + accepted badges displayed

================================================================================
                        SECURITY CONSIDERATIONS
================================================================================

• Private keys (nsec) are NEVER stored on server
• nsec only held in browser memory (session state)
• All authenticated API calls pass nsec in header (X-Nsec)
• HTTPS required for production
• API rate limiting recommended
• Input validation on all endpoints
• Consider WebSocket for real-time updates (optional)

================================================================================
                          FILE STRUCTURE (FINAL)
================================================================================

nostrbadges_gui/
├── backend/                      # NEW: FastAPI backend
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py               # FastAPI app entry
│   │   ├── config.py             # Settings
│   │   ├── routers/
│   │   │   ├── auth.py
│   │   │   ├── badges.py
│   │   │   ├── inbox.py
│   │   │   └── profile.py
│   │   ├── services/             # Business logic wrapping existing modules
│   │   │   ├── badge_service.py
│   │   │   ├── inbox_service.py
│   │   │   └── profile_service.py
│   │   └── models/               # Pydantic models
│   │       ├── requests.py
│   │       └── responses.py
│   └── requirements.txt
│
├── frontend/                     # NEW: Vue.js frontend
│   ├── src/
│   │   ├── views/
│   │   ├── components/
│   │   ├── stores/
│   │   ├── api/
│   │   └── assets/
│   ├── package.json
│   └── vite.config.js
│
├── badge_tool/                   # EXISTING: CLI tools (unchanged)
├── badge_inbox/                  # EXISTING: CLI tools (unchanged)
├── common/                       # EXISTING: Shared modules (used by backend)
├── requirements.txt              # EXISTING: Python deps
└── PROJECT_PLAN.txt              # THIS FILE

================================================================================
                            NEXT STEPS
================================================================================

1. Review this plan and provide feedback
2. Confirm tech stack choices (FastAPI + Vue 3)
3. Decide on styling approach (Tailwind CSS? Custom CSS?)
4. Begin Phase 1: Backend API implementation

================================================================================
                              NOTES
================================================================================

• This plan assumes the existing CLI code works correctly
• API wraps existing Python modules - no rewrite needed
• Vue frontend is separate SPA that calls the API
• Both run on same VPS, Nginx reverse proxy to API
• No database - all data lives on Nostr relays
• Consider adding WebSocket for real-time badge notifications (future)

================================================================================

